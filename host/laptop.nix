{
  pkgs,
  lib,
  inputs,
  nixDir,
  ...
}:
let
  runtimePath = lib.makeBinPath [
    pkgs.wlr-randr
    pkgs.gnugrep
    pkgs.gawk
    pkgs.coreutils
    pkgs.fish
  ];
in
{
  environment.etc."greetd/sway-greeter-config".text = lib.mkForce ''
    default_border none
    default_floating_border none
    gaps inner 0
    gaps outer 0
    for_window [app_id="kitty"] fullscreen enable



    output eDP-1 disable

    input * {
        xkb_layout "us"
        repeat_delay 400
        repeat_rate 40
    }
    input type:touchpad {
        tap enabled
    }

    # hide cursor after 1 second of inactivity
    seat * hide_cursor 1000

    # Startup applications
    # Start gslapper with default wallpaper (forked to background with IPC socket)
    exec gslapper -f -I /tmp/sysc-greet-wallpaper.sock '*' /usr/share/sysc-greet/wallpapers/sysc-greet-default.png
    exec "XDG_CACHE_HOME=/tmp/greeter-cache HOME=/var/lib/greeter ${pkgs.kitty}/bin/kitty --start-as=fullscreen --config=/etc/greetd/kitty.conf ${
      inputs.sysc-greet.packages.${pkgs.system}.default
    }/bin/sysc-greet; ${pkgs.sway}/bin/swaymsg exit"
  '';

  systemd.user.services.screen-toggle = {
    unitConfig = {
      Description = "Disable laptop screen when HDMI connected";
      After = [ "graphical-session.target" ];
      PartOf = [ "graphical-session.target" ];
    };
    serviceConfig = {
      Type = "oneshot";
      Environment = "PATH=${runtimePath}";
      ExecStart = "${nixDir}/scripts/screen-toggle.fish";
    };
    wantedBy = [ "graphical-session.target" ];
  };

  nix.settings = {
    cores = 5;
    max-jobs = 2;
  };
  systemd.services.nix-daemon.serviceConfig = {
    MemoryHigh = "5G";
    MemoryMax = "6G";
  };

}
